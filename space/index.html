<!DOCTYPE html>
<html lang="en">
  <head>
    <title>knoxel space prototype</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="space/style.css">
    <script src="space/colors.js"></script>
    <script src="space/intersect.js"></script>
    <script src="space/script.js"></script>
  </head>  
  <body onload="onLoadBody(event);">
    <svg class="spaceRoot" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
      <defs>
        <marker id="arrowTail" markerWidth="2" markerHeight="4" refX="1" refY="2" orient="auto">
          <polygon points="1 0, 1 4" stroke="#160f19" />
        </marker>
        <marker id="arrowHead" markerWidth="5" markerHeight="4" refX="0.5" refY="2" orient="auto">
          <polygon points="0 0, 5 2, 0 4" fill="#160f19" />
        </marker>
        <marker id="crossTail" markerWidth="4" markerHeight="6" refX="3" refY="3" orient="auto">
          <rect x="1" y="1" width="2" height="4" stroke="#160f19" fill="none"></rect>
        </marker>
        <marker id="crossHead" markerWidth="6" markerHeight="6" refX="1.5" refY="3" orient="auto">
          <circle cx="3" cy="3" r="1.5" stroke="#160f19" fill="none"></circle>
        </marker>
        <marker id="spaceHead" markerWidth="6" markerHeight="6" refX="1.5" refY="3" orient="auto">
          <polyline points="1 1 5 3 1 5" stroke="#160f19" fill="none" />
        </marker>
      </defs>
      <g id="record">
        <foreignObject x="0" y="0" width="0" height="0"></foreignObject>
      </g>
      <g id="knoxels"></g>
      <g id="arrows"></g>
      <g id="bubbles"></g>
      <g id="ghosts"></g>
      <g id="arrowGhosts"></g>
    </svg>
    <div class="spaceBack">
      <svg class="backArrow" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
        <polygon id="backArrowShape" points="4,38 36,38 20,6" stroke-width="4" stroke="#ffff00" fill="#ffff00" />
      </svg>
    </div>
    <div class="spaceForward">
      <svg class="forwardArrow" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
        <polygon id="forwardArrowShape" points="4,3 36,3 20,35" stroke-width="4" stroke="#ffff00" fill="#ffff00" />
      </svg>
    </div>
    <div id="spaceMapButton" class="spaceMap">
      <svg class="mapIcon" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
        <polygon id="mapShape" points="2,2 38,2 38,38 2,38" stroke-width="4" stroke="#ffff00" fill="#ffff00" />
        <circle cx="12" cy="12" r="6" stroke="#160f19" stroke-width="2" fill="#d8b621"></circle>
        <circle cx="28" cy="12" r="6" stroke="#160f19" stroke-width="2" fill="#dc286f"></circle>
        <circle cx="12" cy="28" r="6" stroke="#160f19" stroke-width="2" fill="#36945b"></circle>
        <circle cx="28" cy="28" r="6" stroke="#160f19" stroke-width="2" fill="#5571f1"></circle>
      </svg>
    </div>
    <div id="spaceHostButton" class="spaceHost">
      <svg class="hostIcon" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
        <polygon id="hostShape" points="2,2 38,2 38,38 2,38" stroke-width="4" stroke="#ffff00" fill="#ffff00" />
        <circle cx="18" cy="18" r="8" fill="#d8b621" stroke="#160f19" stroke-width="2" stroke-dasharray="0 4" stroke-linecap="square"></circle>
        <circle cx="26" cy="26" r="8" fill="#d8b621" stroke="#160f19" stroke-width="2" opacity="0.5"></circle>
      </svg>
    </div>
    <div id="autosizer"></div>
    <dialog id="colorpicker" onkeypress="onKeyPressColorpicker(event);">
      <p>
        Edit knyte color
      </p>
      <input>
      <p id="colorset"></p>
      <p>
        <button onclick="onClickColorpickerClose();">
          cancel (esc)
        </button>
        <button onclick="onClickColorpickerOk();">
          OK (enter)
        </button>
      </p>
    </dialog>
    <script>
      function onKeyPressColorpicker(e)
      {
        if (e.code === 'Enter' && !e.keyShift && !e.keyAlt && !e.keyMeta)
          onClickColorpickerOk();
        else if (e.code === 'Escape' && !e.keyShift && !e.keyAlt && !e.keyMeta)
          onClickColorpickerClose();
      }
      
      function onClickColorpickerClose()
      {
        const colorpickerDialog = document.getElementById('colorpicker');
        colorpickerDialog.close();  
      }
      
      function onClickColorpickerOk()
      {
        const colorpickerDialog = document.getElementById('colorpicker');
        const colorpickerInput = colorpickerDialog.getElementsByTagName('input')[0];
        colorpickerDialog.returnValue = colorpickerInput.value;
        colorpickerDialog.close();
      }
      
      function onClickColorpickerColorButton(e)
      {
        const colorpickerDialog = document.getElementById('colorpicker');
        const colorpickerInput = colorpickerDialog.getElementsByTagName('input')[0];
        colorpickerInput.value = e.target.dataset.color;
        onClickColorpickerOk();
      }
      
      const colorset = document.getElementById('colorset');
      for (let i = 0; i < visualThemeColors.elements.length; ++i)
      {
        const color = visualThemeColors.elements[i];
        colorset.innerHTML += '<button data-color="' + color + '" style="background-color: ' + color + ';" ' +
          'class="colorpickerColorButton" onclick="onClickColorpickerColorButton(event);"></button>';
      }
    </script>
  </body>
</html>